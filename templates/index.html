<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>UptimePro | AI Web Health & Performance Monitor</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Outfit:wght@400;700&display=swap"
    rel="stylesheet">

  <style>
    /* Modern Dark Theme - Deep Space Palette */
    :root {
      /* Colors */
      --bg-main: #0B0F19;
      /* Very dark blue/black */
      --bg-secondary: #0f172a;
      --bg-glass: rgba(30, 41, 59, 0.4);
      --bg-glass-heavy: rgba(15, 23, 42, 0.85);

      --primary: #8B5CF6;
      /* Violet 500 */
      --primary-hover: #7C3AED;
      --primary-glow: rgba(139, 92, 246, 0.5);

      --secondary: #3b82f6;
      /* Blue 500 */
      --accent: #F472B6;
      /* Pink 400 */

      --success: #10B981;
      --success-bg: rgba(16, 185, 129, 0.1);
      --warning: #F59E0B;
      --warning-bg: rgba(245, 158, 11, 0.1);
      --danger: #EF4444;
      --danger-bg: rgba(239, 68, 68, 0.1);

      --text-main: #F8FAFC;
      --text-muted: #94A3B8;

      --border: rgba(255, 255, 255, 0.08);
      --border-hover: rgba(255, 255, 255, 0.15);

      /* Radii */
      --radius-sm: 0.5rem;
      --radius-md: 1rem;
      --radius-lg: 1.5rem;
      --radius-full: 9999px;

      /* Effects */
      --blur-md: blur(12px);
      --blur-lg: blur(24px);
      --shadow-sm: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.3);
      --glow-primary: 0 0 20px rgba(139, 92, 246, 0.3);
      --input-bg: rgba(255, 255, 255, 0.03);
      --input-text: #F8FAFC;
    }

    /* Light Theme */
    body.light-mode {
      --bg-main: #f8fafc;
      --bg-secondary: #e2e8f0;
      --bg-glass: rgba(255, 255, 255, 0.8);
      --bg-glass-heavy: rgba(255, 255, 255, 0.95);
      --text-main: #1e293b;
      --text-muted: #64748b;
      --border: rgba(0, 0, 0, 0.08);
      --border-hover: rgba(0, 0, 0, 0.15);
      --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
      --input-bg: #ffffff;
      --input-text: #1e293b;
      background-image: none;
      background-color: var(--bg-main);
    }

    body.light-mode header.app-header {
      background: rgba(255, 255, 255, 0.9);
    }

    body.light-mode .glass-panel {
      background: rgba(255, 255, 255, 0.8);
    }

    body.light-mode .hero-title {
      background: linear-gradient(135deg, #1e293b 0%, #475569 100%);
      -webkit-background-clip: text;
      background-clip: text;
    }

    /* Toast Notifications */
    .toast-container {
      position: fixed;
      top: 80px;
      right: 20px;
      z-index: 9999;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .toast {
      padding: 14px 20px;
      border-radius: 12px;
      color: white;
      font-size: 0.9rem;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 10px;
      animation: toastSlide 0.3s ease-out;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
      max-width: 320px;
    }

    .toast.success {
      background: linear-gradient(135deg, #10b981, #059669);
    }

    .toast.error {
      background: linear-gradient(135deg, #ef4444, #dc2626);
    }

    .toast.warning {
      background: linear-gradient(135deg, #f59e0b, #d97706);
    }

    .toast.info {
      background: linear-gradient(135deg, #3b82f6, #2563eb);
    }

    @keyframes toastSlide {
      from {
        opacity: 0;
        transform: translateX(100px);
      }

      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    @keyframes toastFadeOut {
      from {
        opacity: 1;
        transform: translateX(0);
      }

      to {
        opacity: 0;
        transform: translateX(100px);
      }
    }

    /* Health Indicator Bar */
    .health-indicator {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 6px 12px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 20px;
      font-size: 0.8rem;
    }

    .health-bar {
      width: 60px;
      height: 6px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 3px;
      overflow: hidden;
    }

    .health-fill {
      height: 100%;
      border-radius: 3px;
      transition: width 0.5s ease, background 0.3s;
    }

    .health-fill.good {
      background: #10b981;
    }

    .health-fill.warning {
      background: #f59e0b;
    }

    .health-fill.danger {
      background: #ef4444;
    }

    /* Theme Toggle Button */
    .theme-toggle {
      background: rgba(255, 255, 255, 0.1);
      border: none;
      width: 36px;
      height: 36px;
      border-radius: 10px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text-muted);
      transition: all 0.2s;
    }

    .theme-toggle:hover {
      background: rgba(255, 255, 255, 0.15);
      color: var(--text-main);
    }

    /* Skeleton Loading */
    .skeleton {
      background: linear-gradient(90deg, rgba(255, 255, 255, 0.05) 25%, rgba(255, 255, 255, 0.1) 50%, rgba(255, 255, 255, 0.05) 75%);
      background-size: 200% 100%;
      animation: skeletonShimmer 1.5s infinite;
      border-radius: 8px;
    }

    @keyframes skeletonShimmer {
      0% {
        background-position: 200% 0;
      }

      100% {
        background-position: -200% 0;
      }
    }

    .skeleton-text {
      height: 16px;
      margin-bottom: 8px;
    }

    .skeleton-title {
      height: 24px;
      width: 60%;
      margin-bottom: 12px;
    }

    .skeleton-card {
      height: 80px;
      margin-bottom: 12px;
    }

    /* Typing Indicator */
    .typing-indicator {
      display: flex;
      align-items: center;
      gap: 4px;
      padding: 10px 14px;
    }

    .typing-dot {
      width: 8px;
      height: 8px;
      background: #64748b;
      border-radius: 50%;
      animation: typingBounce 1.4s infinite ease-in-out;
    }

    .typing-dot:nth-child(1) {
      animation-delay: 0s;
    }

    .typing-dot:nth-child(2) {
      animation-delay: 0.2s;
    }

    .typing-dot:nth-child(3) {
      animation-delay: 0.4s;
    }

    @keyframes typingBounce {

      0%,
      60%,
      100% {
        transform: translateY(0);
      }

      30% {
        transform: translateY(-6px);
      }
    }

    /* Base Styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      background-color: var(--bg-main);
      background-image:
        radial-gradient(at 0% 0%, hsla(253, 16%, 7%, 1) 0, transparent 50%),
        radial-gradient(at 50% 0%, hsla(225, 39%, 30%, 1) 0, transparent 50%),
        radial-gradient(at 100% 0%, hsla(339, 49%, 30%, 1) 0, transparent 50%);
      background-attachment: fixed;
      color: var(--text-main);
      line-height: 1.6;
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* Animations */
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes pulse {

      0%,
      100% {
        opacity: 1;
      }

      50% {
        opacity: 0.6;
      }
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    .fade-in-up {
      animation: fadeInUp 0.6s ease-out backwards;
    }

    /* Typography */
    h1,
    h2,
    h3,
    h4,
    h5 {
      font-weight: 700;
      line-height: 1.2;
    }

    h1 {
      font-size: clamp(2rem, 5vw, 3.5rem);
      letter-spacing: -0.02em;
    }

    /* Link Resets */
    a {
      color: inherit;
      text-decoration: none;
    }

    /* Utilities */
    .hidden {
      display: none !important;
    }

    .container {
      max-width: 1280px;
      margin: 0 auto;
      padding: 0 1.5rem;
    }

    /* --- Components --- */

    /* Glass Panels */
    .glass-panel {
      background: var(--bg-glass);
      backdrop-filter: var(--blur-md);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-lg);
      padding: 1.5rem;
      transition: transform 0.3s ease, border-color 0.3s ease;
    }

    .glass-panel:hover {
      border-color: var(--border-hover);
    }

    /* Buttons */
    .btn {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.75rem 1.5rem;
      border-radius: var(--radius-md);
      font-weight: 600;
      font-size: 0.95rem;
      cursor: pointer;
      border: none;
      transition: all 0.2s ease;
      justify-content: center;
    }

    .btn-primary {
      background: var(--primary);
      color: white;
      box-shadow: 0 4px 12px var(--primary-glow);
    }

    .btn-primary:hover {
      background: var(--primary-hover);
      transform: translateY(-2px);
      box-shadow: 0 8px 20px var(--primary-glow);
    }

    .btn-primary:active {
      transform: translateY(0);
    }

    .btn-outline {
      background: transparent;
      border: 1px solid var(--border);
      color: var(--text-muted);
    }

    .btn-outline:hover {
      border-color: var(--primary);
      color: var(--primary);
      background: rgba(var(--primary), 0.05);
    }

    .btn-icon {
      padding: 0.5rem;
      border-radius: 50%;
      aspect-ratio: 1;
    }

    /* Inputs */
    input {
      width: 100%;
      padding: 0.8rem 1.2rem;
      border-radius: var(--radius-md);
      background: var(--input-bg);
      border: 1px solid var(--border);
      color: var(--input-text);
      font-size: 1rem;
      transition: all 0.2s;
    }

    input:focus {
      outline: none;
      border-color: var(--primary);
      background: var(--input-bg);
      box-shadow: 0 0 0 2px var(--primary-glow);
    }

    /* --- Layout Specifics --- */

    /* Header */
    header.app-header {
      position: sticky;
      top: 0;
      z-index: 50;
      background: rgba(11, 15, 25, 0.8);
      backdrop-filter: var(--blur-lg);
      border-bottom: 1px solid var(--border);
      padding: 1rem 0;
    }

    header .container {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo {
      font-size: 1.5rem;
      font-weight: 800;
      color: var(--text-main);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .logo span {
      color: var(--primary);
    }

    .logo .badge {
      font-size: 0.75rem;
      padding: 0.2rem 0.5rem;
      background: var(--bg-glass);
      border: 1px solid var(--border);
      border-radius: var(--radius-full);
      font-weight: 500;
      color: var(--text-muted);
    }

    /* Hero Section */
    .hero-section {
      text-align: center;
      padding: 6rem 1rem 4rem;
      max-width: 800px;
      margin: 0 auto;
    }

    .hero-title {
      background: linear-gradient(135deg, var(--text-main) 0%, var(--text-muted) 100%);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 1rem;
    }

    .hero-subtitle {
      font-size: 1.25rem;
      color: var(--text-muted);
      margin-bottom: 3rem;
    }

    /* Search Box */
    .search-box-wrapper {
      background: var(--input-bg);
      border: 1px solid var(--border);
      padding: 0.5rem;
      border-radius: 4rem;
      display: flex;
      align-items: center;
      gap: 1rem;
      box-shadow: var(--shadow-lg);
      transition: border-color 0.3s;
      position: relative;
      /* Added for suggestions positioning */
    }

    /* Search Suggestions Styles */
    .search-suggestions {
      position: absolute;
      top: 100%;
      left: 2rem;
      right: 2rem;
      background: var(--bg-glass);
      backdrop-filter: blur(12px);
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      margin-top: 0.5rem;
      box-shadow: var(--shadow-xl);
      z-index: 1000;
      display: none;
      max-height: 250px;
      overflow-y: auto;
      padding: 0.5rem;
    }

    .suggestion-item {
      padding: 0.8rem 1rem;
      cursor: pointer;
      border-radius: var(--radius-sm);
      display: flex;
      align-items: center;
      gap: 0.8rem;
      color: var(--text-main);
      transition: all 0.2s;
      font-size: 0.9rem;
    }

    .suggestion-item:hover {
      background: rgba(var(--primary), 0.1);
      color: var(--primary);
      transform: translateX(5px);
    }

    .suggestion-item i {
      opacity: 0.5;
    }

    .suggestion-header {
      padding: 0.5rem 1rem;
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--text-muted);
      border-bottom: 1px solid var(--border);
      margin-bottom: 0.5rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .clear-history {
      cursor: pointer;
      color: var(--danger);
      font-size: 0.7rem;
    }

    .clear-history:hover {
      text-decoration: underline;
    }

    .search-box-wrapper:focus-within {
      border-color: var(--primary);
      box-shadow: 0 0 0 4px var(--primary-glow);
    }

    .search-input {
      flex: 1;
      background: transparent;
      border: none;
      padding-left: 1.5rem;
      font-size: 1.1rem;
    }

    .search-input:focus {
      background: transparent;
      box-shadow: none;
    }

    /* Monitors List */
    .monitor-list {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .monitor-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1.25rem 2rem;
      background: rgba(255, 255, 255, 0.02);
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      cursor: pointer;
      transition: all 0.3s;
    }

    .monitor-item:hover {
      background: rgba(255, 255, 255, 0.05);
      border-color: var(--primary);
      transform: translateX(4px);
    }

    .monitor-info {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }

    .monitor-name {
      font-weight: 600;
      font-size: 1.1rem;
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .badge-strategy {
      font-size: 0.7rem;
      text-transform: uppercase;
      background: var(--bg-glass);
      border: 1px solid var(--border);
      padding: 0.15rem 0.5rem;
      border-radius: var(--radius-sm);
      letter-spacing: 0.05em;
    }

    /* Global Stats Section */
    .global-stats-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2.5rem;
    }

    .stat-card {
      background: var(--bg-glass);
      border: 1px solid var(--border);
      padding: 1.5rem;
      border-radius: var(--radius-lg);
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }

    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow-xl);
      border-color: var(--primary);
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 4px;
      background: var(--primary);
      opacity: 0.3;
    }

    .stat-label {
      font-size: 0.8rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.1em;
      font-weight: 600;
    }

    .stat-value {
      font-size: 2rem;
      font-weight: 800;
      color: var(--text-main);
      display: flex;
      align-items: baseline;
      gap: 0.2rem;
    }

    .stat-unit {
      font-size: 1rem;
      color: var(--text-muted);
      font-weight: 500;
    }

    .stat-trend {
      font-size: 0.75rem;
      display: flex;
      align-items: center;
      gap: 0.3rem;
    }

    .trend-up {
      color: var(--success);
    }

    .trend-neutral {
      color: var(--text-muted);
    }

    .monitor-url {
      color: var(--text-muted);
      font-size: 0.9rem;
    }

    .monitor-stats {
      display: flex;
      align-items: center;
      gap: 2rem;
    }

    .score-pill {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 0.5rem 1rem;
      border-radius: var(--radius-md);
      border: 1px solid transparent;
      min-width: 80px;
    }

    .score-label {
      font-size: 0.65rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      opacity: 0.8;
    }

    .score-val {
      font-size: 1.5rem;
      font-weight: 700;
      line-height: 1;
    }

    .btn-delete {
      background: transparent;
      color: var(--text-muted);
      opacity: 0.6;
    }

    .btn-delete:hover {
      opacity: 1;
      color: var(--danger);
      background: rgba(239, 68, 68, 0.1);
    }

    .monitor-item.deleting {
      opacity: 0;
      transform: translateX(100px);
      pointer-events: none;
    }

    /* Report Detail View */
    .report-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      flex-wrap: wrap;
      gap: 2rem;
      margin-bottom: 2rem;
    }

    .header-content {
      flex: 1;
      min-width: 300px;
    }

    .btn-back {
      background: none;
      border: none;
      color: var(--text-muted);
      font-weight: 600;
      margin-bottom: 1rem;
      cursor: pointer;
      padding: 0;
      display: inline-flex;
      align-items: center;
    }

    .btn-back:hover {
      color: var(--primary);
      transform: translateX(-4px);
    }

    .header-title-group h1 {
      font-size: 2rem;
      margin-bottom: 0.5rem;
      word-break: break-all;
    }

    .strategy-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      padding: 0.4rem 0.8rem;
      border-radius: var(--radius-full);
      font-size: 0.85rem;
      font-weight: 600;
      text-transform: capitalize;
    }

    .strategy-badge.mobile {
      background: rgba(59, 130, 246, 0.15);
      color: #60a5fa;
    }

    .strategy-badge.desktop {
      background: rgba(16, 185, 129, 0.15);
      color: #34d399;
    }

    .header-actions {
      display: flex;
      gap: 1rem;
    }

    /* Audit Status Panel */
    .audit-status-panel {
      background: rgba(255, 255, 255, 0.02);
      border: 1px solid var(--border);
      padding: 1rem;
      border-radius: var(--radius-md);
      min-width: 280px;
    }

    .status-text-pulse {
      font-weight: 600;
      color: var(--warning);
      animation: pulse 1.5s infinite;
      margin-bottom: 0.5rem;
    }

    .progress-wrapper {
      background: rgba(255, 255, 255, 0.1);
      height: 6px;
      border-radius: 10px;
      overflow: hidden;
    }

    .progress-fill {
      background: var(--primary);
      height: 100%;
    }

    .time-est {
      font-size: 0.8rem;
      color: var(--text-muted);
      margin-top: 0.5rem;
      text-align: right;
    }

    /* Report Grid */
    .report-grid {
      display: grid;
      grid-template-columns: 1.2fr 1fr;
      gap: 2rem;
      margin-bottom: 2rem;
    }

    @media(max-width: 900px) {
      .report-grid {
        grid-template-columns: 1fr;
      }
    }

    /* Gauges */
    .gauges-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 2rem;
    }

    /* ===== Professional Chat Widget ===== */
    .chat-widget {
      position: fixed;
      bottom: 90px;
      right: 20px;
      width: 360px;
      max-height: 500px;
      background: #1a1f2e;
      border-radius: 20px;
      box-shadow:
        0 20px 40px rgba(0, 0, 0, 0.35),
        0 0 0 1px rgba(255, 255, 255, 0.08);
      display: none;
      flex-direction: column;
      overflow: hidden;
      z-index: 1000;
      border: 1px solid rgba(255, 255, 255, 0.06);
      animation: chatSlideIn 0.35s ease-out;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    }

    @keyframes chatSlideIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .chat-header {
      background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
      color: white;
      padding: 14px 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: none;
      flex-shrink: 0;
      width: 100%;
    }

    .chat-header-info {
      display: flex;
      align-items: center;
      gap: 12px;
      flex: 1;
    }

    .chat-avatar {
      width: 38px;
      height: 38px;
      background: rgba(255, 255, 255, 0.15);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.3rem;
      flex-shrink: 0;
    }

    .chat-header-text {
      display: flex;
      flex-direction: column;
      gap: 1px;
      flex: 1;
      min-width: 0;
    }

    .chat-title {
      font-size: 0.95rem;
      font-weight: 600;
      letter-spacing: 0.2px;
      line-height: 1.3;
    }

    .chat-status {
      font-size: 0.72rem;
      opacity: 0.85;
      display: flex;
      align-items: center;
      gap: 5px;
      font-weight: 400;
    }

    .status-dot {
      width: 6px;
      height: 6px;
      background: #34d399;
      border-radius: 50%;
      box-shadow: 0 0 5px rgba(52, 211, 153, 0.5);
    }

    .chat-header-actions {
      display: flex;
      gap: 6px;
      flex-shrink: 0;
    }

    .chat-action-btn {
      background: rgba(255, 255, 255, 0.12);
      border: none;
      color: white;
      width: 30px;
      height: 30px;
      border-radius: 8px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.85rem;
      transition: all 0.2s ease;
    }

    .chat-action-btn:hover {
      background: rgba(255, 255, 255, 0.22);
    }

    /* Quick Questions - Bottom Section */
    #quick-questions {
      padding: 10px 14px;
      border-top: 1px solid rgba(255, 255, 255, 0.05);
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      background: #1e2438;
      flex-shrink: 0;
    }

    .quick-btn {
      background: rgba(255, 255, 255, 0.04);
      border: 1px solid rgba(255, 255, 255, 0.08);
      padding: 6px 12px;
      border-radius: 16px;
      font-size: 0.75rem;
      color: #94a3b8;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .quick-btn:hover {
      background: #2563eb;
      border-color: #2563eb;
      color: white;
    }

    .quick-btn span {
      font-size: 0.85rem;
    }

    /* Messages Area */
    .chat-messages {
      flex: 1;
      min-height: 220px;
      max-height: 300px;
      overflow-y: auto;
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      scroll-behavior: smooth;
      background: #151a28;
    }

    /* Scrollbar */
    .chat-messages::-webkit-scrollbar {
      width: 4px;
    }

    .chat-messages::-webkit-scrollbar-track {
      background: transparent;
    }

    .chat-messages::-webkit-scrollbar-thumb {
      background: rgba(37, 99, 235, 0.4);
      border-radius: 4px;
    }

    .chat-messages::-webkit-scrollbar-thumb:hover {
      background: rgba(37, 99, 235, 0.6);
    }

    .chat-messages {
      scrollbar-width: thin;
      scrollbar-color: rgba(37, 99, 235, 0.4) transparent;
    }

    .msg {
      padding: 12px 16px;
      border-radius: 14px;
      max-width: 85%;
      font-size: 0.875rem;
      line-height: 1.5;
      position: relative;
      animation: msgSlide 0.25s ease-out;
      word-wrap: break-word;
    }

    @keyframes msgSlide {
      from {
        opacity: 0;
        transform: translateY(6px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .msg-bot {
      background: #252d42;
      color: #e2e8f0;
      align-self: flex-start;
      border-bottom-left-radius: 4px;
    }

    /* Light mode overrides for chat */
    body.light-mode .chat-widget {
      background: #ffffff;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
      border-color: rgba(0, 0, 0, 0.1);
    }

    body.light-mode .chat-messages {
      background: #f1f5f9;
    }

    body.light-mode #quick-questions {
      background: #e2e8f0;
    }

    body.light-mode .quick-btn {
      background: white;
      color: #64748b;
      border-color: rgba(0, 0, 0, 0.1);
    }

    body.light-mode .msg-bot {
      background: white;
      color: #1e293b;
      border: 1px solid rgba(0, 0, 0, 0.05);
    }

    body.light-mode .chat-input-area {
      background: #ffffff;
      border-top-color: rgba(0, 0, 0, 0.1);
    }


    .msg-user {
      background: linear-gradient(135deg, #2563eb, #1d4ed8);
      color: white;
      align-self: flex-end;
      border-bottom-right-radius: 4px;
    }

    /* Input Area */
    .chat-input-area {
      padding: 14px 16px;
      border-top: 1px solid rgba(255, 255, 255, 0.05);
      display: flex;
      gap: 10px;
      background: #1a1f2e;
      flex-shrink: 0;
    }

    .chat-input-area input {
      flex: 1;
      padding: 12px 16px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      outline: none;
      transition: all 0.2s ease;
      background: #252d42;
      color: #f1f5f9;
      font-size: 0.875rem;
    }

    .chat-input-area input::placeholder {
      color: #64748b;
    }

    .chat-input-area input:focus {
      border-color: #2563eb;
      box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.2);
    }

    .chat-input-area button {
      width: 42px;
      height: 42px;
      background: linear-gradient(135deg, #2563eb, #1d4ed8);
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }

    .chat-input-area button:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 12px rgba(37, 99, 235, 0.4);
    }

    /* Responsive */
    @media (max-width: 480px) {
      .chat-widget {
        width: calc(100vw - 20px);
        right: 10px;
        bottom: 80px;
        max-height: 450px;
      }

      .chat-messages {
        max-height: 220px;
      }
    }

    .gauge-chart {
      position: relative;
      width: 100px;
      height: 100px;
      margin: 0 auto 0.5rem;
    }

    .circular-chart {
      display: block;
      margin: 0 auto;
      max-width: 100%;
      max-height: 100%;
      transform: rotate(-90deg);
    }

    .circle-bg {
      fill: none;
      stroke: rgba(255, 255, 255, 0.05);
      stroke-width: 2.5;
    }

    .circle {
      fill: none;
      stroke-width: 2.5;
      stroke-linecap: round;
      transition: stroke-dasharray 1s ease-out;
    }

    .gauge-value {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 1.5rem;
      font-weight: 800;
    }

    .gauge-label {
      display: flex;
      flex-direction: column;
      font-size: 0.9rem;
      font-weight: 600;
    }

    .gauge-label .ar {
      font-size: 0.75rem;
    }

    .quick-btn {
      background: #f3f4f6;
      border: 1px solid #ddd;
      padding: 5px 10px;
      border-radius: 15px;
      font-size: 0.8em;
      cursor: pointer;
      white-space: nowrap;
      transition: 0.2s;
    }

    .quick-btn:hover {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
    }

    color: var(--text-muted);
    }

    /* Screenshot */
    .screenshot-frame {
      width: 100%;
      aspect-ratio: 16/9;
      background: #000;
      border-radius: var(--radius-md);
      overflow: hidden;
      border: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .screenshot-frame img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      object-position: top;
    }

    .placeholder-screenshot {
      text-align: center;
      color: var(--text-muted);
    }

    /* Metrics Grid */
    .key-metrics-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    .metric-card {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .metric-header {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .metric-acronym {
      font-weight: 700;
      color: var(--text-muted);
    }

    .metric-title {
      font-size: 0.8rem;
      color: var(--text-muted);
      opacity: 0.7;
    }

    .metric-value {
      font-size: 1.75rem;
      font-weight: 700;
    }

    /* Opportunities */
    .opportunities-list {
      display: grid;
      gap: 1rem;
    }

    .opportunity-card {
      background: rgba(255, 255, 255, 0.02);
      padding: 1.25rem;
      border-radius: var(--radius-md);
      border-left: 4px solid var(--border);
    }

    .opp-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 0.5rem;
    }

    .opp-title {
      font-weight: 600;
    }

    .opp-score {
      font-size: 0.85rem;
      font-weight: 600;
    }

    .opp-desc {
      color: var(--text-muted);
      font-size: 0.9rem;
    }

    /* Chart */
    .chart-container {
      height: 350px;
      width: 100%;
    }

    /* Filmstrip */
    .filmstrip-row {
      display: flex;
      overflow-x: auto;
      gap: 1rem;
      padding-bottom: 1rem;
      scrollbar-color: var(--primary) transparent;
      scrollbar-width: thin;
    }

    .filmstrip-item {
      flex: 0 0 120px;
      background: black;
      padding: 0.5rem;
      border-radius: var(--radius-md);
      border: 1px solid var(--border);
      text-align: center;
    }

    .filmstrip-item img {
      width: 100%;
      border-radius: 4px;
      margin-bottom: 0.5rem;
    }

    .filmstrip-time {
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    /* Chat Widget */
    #chat-widget {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      z-index: 100;
      display: flex;
      flex-direction: column;
      align-items: flex-end;
    }

    #chat-toggle {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: var(--primary);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 10px 25px var(--primary-glow);
      cursor: pointer;
      transition: transform 0.3s;
    }

    #chat-toggle:hover {
      transform: scale(1.1) rotate(10deg);
    }

    #chat-window {
      width: 350px;
      height: 500px;
      background: var(--bg-glass-heavy);
      backdrop-filter: var(--blur-lg);
      border: 1px solid var(--border);
      border-radius: 1.5rem;
      margin-bottom: 1rem;
      display: none;
      /* Flex when open */
      flex-direction: column;
      overflow: hidden;
      box-shadow: var(--shadow-lg);
    }

    #chat-header {
      padding: 1rem 1.5rem;
      background: rgba(255, 255, 255, 0.03);
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
    }

    #chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: 1rem;
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .msg {
      padding: 0.75rem 1rem;
      border-radius: 1rem;
      max-width: 85%;
      font-size: 0.9rem;
      line-height: 1.4;
    }

    .msg-bot {
      background: rgba(255, 255, 255, 0.05);
      border-bottom-left-radius: 0.2rem;
      align-self: flex-start;
    }

    .msg-user {
      background: var(--primary);
      color: white;
      border-bottom-right-radius: 0.2rem;
      align-self: flex-end;
    }

    #chat-form {
      padding: 1rem;
      border-top: 1px solid var(--border);
      display: flex;
      gap: 0.5rem;
    }

    /* Spinner Utils */
    .spinner {
      width: 1em;
      height: 1em;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-top-color: white;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      display: inline-block;
    }

    .spinner-large {
      width: 3rem;
      height: 3rem;
      border: 3px solid rgba(255, 255, 255, 0.1);
      border-top-color: var(--primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 1.5rem;
    }

    /* Responsive */
    @media (max-width: 640px) {
      h1 {
        font-size: 2rem;
      }

      .hero-section {
        padding-top: 4rem;
      }

      .search-box-wrapper {
        flex-direction: column;
        padding: 1rem;
        border-radius: 1.5rem;
        gap: 0.5rem;
      }

      .search-input {
        text-align: center;
        padding-left: 0;
        width: 100%;
        border-bottom: 1px solid var(--border);
        padding-bottom: 0.5rem;
      }

      .device-toggle {
        width: 100%;
        justify-content: center;
      }

      #chat-window {
        width: calc(100vw - 2rem);
        position: fixed;
        bottom: 5rem;
        right: 1rem;
      }
    }

    /* Print / PDF Styles */
    @media print {

      /* Reset Page */
      @page {
        margin: 1cm;
        size: A4 portrait;
      }

      body {
        background: white !important;
        color: #1e293b !important;
        /* Slate 800 */
        font-size: 11pt;
        -webkit-print-color-adjust: exact !important;
        print-color-adjust: exact !important;
      }

      /* Hide Elements */
      header,
      footer,
      #chat-widget,
      .btn,
      .btn-back,
      .header-actions,
      #hero-area,
      #dashboard-view,
      .search-box-wrapper,
      .device-toggle,
      #login-overlay {
        display: none !important;
      }

      /* Report Container */
      .container {
        max-width: 100% !important;
        padding: 0 !important;
        margin: 0 !important;
      }

      #report-view,
      #detail-section {
        display: block !important;
        padding: 0 !important;
        margin: 0 !important;
        width: 100% !important;
      }

      /* Report Header */
      .report-header {
        background: transparent !important;
        border: none !important;
        box-shadow: none !important;
        padding-bottom: 2rem !important;
        border-bottom: 2px solid #e2e8f0 !important;
        margin-bottom: 2rem;
      }

      .header-title-group h1 {
        font-size: 24pt !important;
        color: #0f172a !important;
        margin-bottom: 0.5rem;
      }

      .strategy-badge {
        color: #000 !important;
        border: 1px solid #ddd;
        background: #f1f5f9 !important;
      }

      /* Cards */
      .glass-panel {
        background: white !important;
        backdrop-filter: none !important;
        border: 1px solid #e2e8f0 !important;
        box-shadow: none !important;
        color: #1e293b !important;
        border-radius: 8px !important;
        page-break-inside: avoid;
      }

      /* Metrics */
      .metric-value {
        color: #0f172a !important;
      }

      .metric-acronym {
        color: #64748b !important;
      }

      /* Gauges */
      .gauge-wrapper .gauge-value {
        color: #0f172a !important;
      }

      /* Ensure charts print */
      .gauge-chart circle,
      .gauge-chart path {
        print-color-adjust: exact;
        -webkit-print-color-adjust: exact;
      }

      /* Screenshot */
      .screenshot-frame {
        border: 1px solid #ccc !important;
        background: #f8fafc !important;
        max-height: 300px;
      }

      /* Text Colors */
      h1,
      h2,
      h3 {
        color: #0f172a !important;
      }

      .text-muted {
        color: #64748b !important;
      }

      /* Opportunities */
      .opportunity-card {
        background: white !important;
        border: 1px solid #e2e8f0 !important;
        border-left-width: 4px !important;
      }

      /* Chart Canvas */
      canvas {
        max-width: 100% !important;
      }

      /* Filmstrip */
      .filmstrip-item {
        background: transparent !important;
        border: none !important;
        page-break-inside: avoid;
      }

      .filmstrip-item img {
        border: 1px solid #ddd;
      }

      /* Add Footer for Print */
      #detail-section::after {
        content: "Generated by UptimePro AI - " attr(data-date);
        display: block;
        text-align: center;
        margin-top: 3rem;
        font-size: 9pt;
        color: #94a3b8;
        border-top: 1px solid #e2e8f0;
        padding-top: 1rem;
      }
    }

    /* Device Toggle - Segmented Control */
    .device-toggle {
      display: flex;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid var(--border);
      border-radius: 2rem;
      padding: 0.3rem;
      gap: 0.5rem;
    }

    .toggle-btn {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      border: none;
      background: transparent;
      color: var(--text-muted);
      padding: 0.6rem 1.2rem;
      border-radius: 1.5rem;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.9rem;
      transition: all 0.2s;
    }

    .toggle-btn svg {
      opacity: 0.7;
    }

    .toggle-btn:hover {
      background: rgba(255, 255, 255, 0.05);
      color: white;
    }

    .toggle-btn.active {
      background: var(--primary);
      color: white;
      box-shadow: 0 2px 10px var(--primary-glow);
    }

    .toggle-btn.active svg {
      opacity: 1;
    }

    /* Dynamic Screenshot Frame */
    .screenshot-frame {
      width: 100%;
      background: #000;
      border-radius: var(--radius-md);
      overflow: hidden;
      border: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: center;
      transition: aspect-ratio 0.3s ease;
    }

    .screenshot-frame.mobile {
      aspect-ratio: 9/16;
      max-width: 360px;
      /* Limit width for mobile screens so they don't take up whole screen height */
      margin: 0 auto;
    }

    .screenshot-frame.desktop {
      aspect-ratio: 16/9;
      max-width: 100%;
    }

    .screenshot-frame img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      /* Ensure full image is visible */
      object-position: top;
      background: #111;
    }

    .placeholder-screenshot {
      text-align: center;
      color: var(--text-muted);
    }

    /* Metrics Grid */
    .key-metrics-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    .metric-card {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .metric-header {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .metric-acronym {
      font-weight: 700;
      color: var(--text-muted);
    }

    .metric-title {
      font-size: 0.8rem;
      color: var(--text-muted);
      opacity: 0.7;
    }

    .metric-value {
      font-size: 1.75rem;
      font-weight: 700;
    }

    /* Opportunities */
    .opportunities-list {
      display: grid;
      gap: 1rem;
    }

    .opportunity-card {
      background: rgba(255, 255, 255, 0.02);
      padding: 1.25rem;
      border-radius: var(--radius-md);
      border-left: 4px solid var(--border);
    }

    .opp-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 0.5rem;
    }

    .opp-title {
      font-weight: 600;
    }

    .opp-score {
      font-size: 0.85rem;
      font-weight: 600;
    }

    .opp-desc {
      color: var(--text-muted);
      font-size: 0.9rem;
    }

    /* Chart */
    .chart-container {
      height: 350px;
      width: 100%;
    }

    /* Filmstrip */
    .filmstrip-row {
      display: flex;
      overflow-x: auto;
      gap: 1rem;
      padding-bottom: 1rem;
      scrollbar-color: var(--primary) transparent;
      scrollbar-width: thin;
    }

    .filmstrip-item {
      flex: 0 0 120px;
      background: black;
      padding: 0.5rem;
      border-radius: var(--radius-md);
      border: 1px solid var(--border);
      text-align: center;
    }

    .filmstrip-item img {
      width: 100%;
      border-radius: 4px;
      margin-bottom: 0.5rem;
    }

    .filmstrip-time {
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    /* Spinner Utils */
    .spinner {
      width: 1em;
      height: 1em;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-top-color: white;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      display: inline-block;
    }

    .spinner-large {
      width: 3rem;
      height: 3rem;
      border: 3px solid rgba(255, 255, 255, 0.1);
      border-top-color: var(--primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 1.5rem;
    }

    /* Responsive */
    @media (max-width: 640px) {
      h1 {
        font-size: 2rem;
      }

      .hero-section {
        padding-top: 4rem;
      }

      .search-box-wrapper {
        flex-direction: column;
        padding: 1rem;
        border-radius: 1.5rem;
        gap: 0.5rem;
      }

      .search-input {
        text-align: center;
        padding-left: 0;
        width: 100%;
        border-bottom: 1px solid var(--border);
        padding-bottom: 0.5rem;
      }

      .device-toggle {
        width: 100%;
        justify-content: center;
      }

      #chat-window {
        width: calc(100vw - 2rem);
        position: fixed;
        bottom: 5rem;
        right: 1rem;
      }
    }

    /* Print / PDF Styles */
    @media print {

      /* Reset Page */
      @page {
        margin: 1cm;
        size: A4 portrait;
      }

      body {
        background: white !important;
        color: #1e293b !important;
        /* Slate 800 */
        font-size: 11pt;
        -webkit-print-color-adjust: exact !important;
        print-color-adjust: exact !important;
      }

      /* Hide Elements */
      header,
      footer,
      #chat-widget,
      .btn,
      .btn-back,
      .header-actions,
      #hero-area,
      #dashboard-view,
      .search-box-wrapper,
      .device-toggle,
      #login-overlay {
        display: none !important;
      }

      /* Report Container */
      .container {
        max-width: 100% !important;
        padding: 0 !important;
        margin: 0 !important;
      }

      #report-view,
      #detail-section {
        display: block !important;
        padding: 0 !important;
        margin: 0 !important;
        width: 100% !important;
      }

      /* Report Header */
      .report-header {
        background: transparent !important;
        border: none !important;
        box-shadow: none !important;
        padding-bottom: 2rem !important;
        border-bottom: 2px solid #e2e8f0 !important;
        margin-bottom: 2rem;
      }

      .header-title-group h1 {
        font-size: 24pt !important;
        color: #0f172a !important;
        margin-bottom: 0.5rem;
      }

      .strategy-badge {
        color: #000 !important;
        border: 1px solid #ddd;
        background: #f1f5f9 !important;
      }

      /* Cards */
      .glass-panel {
        background: white !important;
        backdrop-filter: none !important;
        border: 1px solid #e2e8f0 !important;
        box-shadow: none !important;
        color: #1e293b !important;
        border-radius: 8px !important;
        page-break-inside: avoid;
      }

      /* Metrics */
      .metric-value {
        color: #0f172a !important;
      }

      .metric-acronym {
        color: #64748b !important;
      }

      /* Gauges */
      .gauge-wrapper .gauge-value {
        color: #0f172a !important;
      }

      /* Ensure charts print */
      .gauge-chart circle,
      .gauge-chart path {
        print-color-adjust: exact;
        -webkit-print-color-adjust: exact;
      }

      /* Screenshot */
      .screenshot-frame {
        border: 1px solid #ccc !important;
        background: #f8fafc !important;
        max-height: 300px;
      }

      /* Force screenshot visibility in print */
      .screenshot-frame.mobile {
        max-width: 200px;
      }

      .screenshot-frame.desktop {
        max-width: 400px;
      }

      /* Text Colors */
      h1,
      h2,
      h3 {
        color: #0f172a !important;
      }

      .text-muted {
        color: #64748b !important;
      }

      /* Opportunities */
      .opportunity-card {
        background: white !important;
        border: 1px solid #e2e8f0 !important;
        border-left-width: 4px !important;
      }

      /* Chart Canvas */
      canvas {
        max-width: 100% !important;
      }

      /* Filmstrip */
      .filmstrip-item {
        background: transparent !important;
        border: none !important;
        page-break-inside: avoid;
      }

      .filmstrip-item img {
        border: 1px solid #ddd;
      }

      /* Add Footer for Print */
      #detail-section::after {
        content: "Generated by UptimePro AI - " attr(data-date);
        display: block;
        text-align: center;
        margin-top: 3rem;
        font-size: 9pt;
        color: #94a3b8;
        border-top: 1px solid #e2e8f0;
        padding-top: 1rem;
      }
    }
  </style>
  <link rel="icon" href="data:;base64,iVBORw0KGgo=">

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
  <!-- Toast Container -->
  <div id="toast-container" class="toast-container"></div>

  <!-- Login Overlay -->
  <div id="login-overlay"
    style="position: fixed; inset: 0; background: radial-gradient(circle at center, var(--bg-secondary) 0%, var(--bg-main) 100%); z-index: 9999; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(8px);">
    <div class="glass-panel"
      style="max-width: 420px; width: 90%; text-align: center; padding: 3.5rem; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);">
      <div style="margin-bottom: 2rem;">
        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"
          stroke-linecap="round" stroke-linejoin="round" style="color: var(--primary); margin-bottom: 1rem;">
          <path d="M22 12h-4l-3 9L9 3l-3 9H2" />
        </svg>
        <h1
          style="margin-bottom: 0.5rem; font-size: 2.8rem; letter-spacing: -1px; background: linear-gradient(135deg, #fff 0%, var(--primary) 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
          UptimePro</h1>
        <p style="color: var(--text-muted); font-size: 1rem; font-weight: 500;">AI-Powered Health Monitoring</p>
      </div>
      <form id="login-form" style="display: flex; flex-direction: column; gap: 1.2rem;">
        <div style="position: relative;">
          <input type="text" id="username" placeholder="Username" required
            style="padding-left: 3rem; background: rgba(255,255,255,0.03); border-radius: 12px; transition: all 0.3s;">
          <span style="position: absolute; left: 1rem; top: 50%; transform: translateY(-50%); opacity: 0.5;">ðŸ‘¤</span>
        </div>
        <div style="position: relative;">
          <input type="password" id="password" placeholder="Password" required
            style="padding-left: 3rem; background: rgba(255,255,255,0.03); border-radius: 12px; transition: all 0.3s;">
          <span style="position: absolute; left: 1rem; top: 50%; transform: translateY(-50%); opacity: 0.5;">ðŸ”’</span>
        </div>
        <button type="submit" class="btn btn-primary"
          style="width: 100%; padding: 1.1rem; border-radius: 12px; font-size: 1rem; text-transform: uppercase; letter-spacing: 1px; font-weight: 700; margin-top: 0.5rem;">
          Secure Sign In
        </button>
      </form>
      <p id="login-error" style="color: var(--danger); margin-top: 1.5rem; font-size: 0.9rem; font-weight: 500;"></p>
      <div style="margin-top: 2rem; font-size: 0.8rem; color: var(--text-muted); opacity: 0.7;">
        <p>Â© 2026 UptimePro. All rights reserved.</p>
        <div
          style="margin-top: 0.8rem; display: flex; justify-content: center; gap: 1.5rem; font-weight: 600; color: rgba(255,255,255,0.4);">
          <span>Qais Amro</span>
          <span>Odai Edeh</span>
        </div>
        <p style="margin-top: 1rem; font-size: 0.7rem; opacity: 0.5;">System version: 2.1.0-stable</p>
      </div>
    </div>
  </div>

  <!-- Header -->
  <header class="app-header">
    <div class="container">
      <div class="logo">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"
          stroke-linecap="round" stroke-linejoin="round" style="color: var(--primary)">
          <path d="M22 12h-4l-3 9L9 3l-3 9H2" />
        </svg>
        UptimePro <span class="badge">PRO</span>
      </div>

      <div style="display: flex; gap: 1rem; align-items: center;">
        <!-- Health Indicator -->
        <div id="health-indicator" class="health-indicator" style="display: none;">
          <span id="health-text">0/0</span>
          <div class="health-bar">
            <div id="health-fill" class="health-fill good" style="width: 100%;"></div>
          </div>
        </div>

        <!-- Theme Toggle -->
        <button class="theme-toggle" onclick="toggleTheme()" title="Toggle Theme">
          <svg id="theme-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
            stroke-width="2">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
          </svg>
        </button>

        <div id="user-display" style="font-size: 0.9rem; color: var(--text-muted);"></div>
        <button onclick="logout()" class="btn btn-outline" style="padding: 0.4rem 0.8rem; font-size: 0.8rem;">
          Sign Out
        </button>
      </div>
    </div>
  </header>

  <!-- Main Content Areas -->
  <main class="container">

    <!-- Hero / Search Area -->
    <section id="hero-area" class="hero-section fade-in-up">
      <h1 class="hero-title">Optimize Your Web Experience</h1>
      <p class="hero-subtitle">Real-time performance audits, availability monitoring, and AI-driven insights.
        <br><span style="font-size: 0.9em; opacity: 0.8;">(Ø§Ø¬Ø¹Ù„ ØµÙØ­Ø§ØªÙƒ Ø³Ø±ÙŠØ¹Ø© Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©)</span>
      </p>

      <form id="psi-search-form" class="search-box-wrapper">
        <input type="url" class="search-input" id="psi-url-input" placeholder="Enter website URL for instant audit..."
          required autocomplete="off">
        <div id="search-suggestions" class="search-suggestions"></div>

        <div class="device-toggle">
          <button type="button" class="toggle-btn active" id="btn-mobile" onclick="setStrategy('mobile')"
            title="Use Mobile Strategy">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="5" y="2" width="14" height="20" rx="2" ry="2"></rect>
              <line x1="12" y1="18" x2="12.01" y2="18"></line>
            </svg>
            <span>Mobile</span>
          </button>
          <button type="button" class="toggle-btn" id="btn-desktop" onclick="setStrategy('desktop')"
            title="Use Desktop Strategy">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>
              <line x1="8" y1="21" x2="16" y2="21"></line>
              <line x1="12" y1="17" x2="12" y2="21"></line>
            </svg>
            <span>Desktop</span>
          </button>
        </div>

        <button type="submit" class="btn btn-primary"
          style="padding: 0.8rem 2rem; border-radius: 2rem;">Analyze</button>
      </form>

      <div style="margin-top: 3rem;">
        <button onclick="showDashboard()" class="btn btn-outline" style="border-radius: 2rem;">
          View Recent Audits <span style="opacity: 0.6">&darr;</span>
        </button>
      </div>
    </section>

    <!-- Detailed Report View (Hidden by default) -->
    <section id="report-view" style="display: none; padding-top: 2rem;">
      <div id="detail-section">
        <!-- Dynamic Content Injected Here -->
      </div>
    </section>

    <!-- Dashboard/List View (Hidden by default) -->
    <section id="dashboard-view" style="display: none; padding-top: 2rem; max-width: 1000px; margin: 0 auto 4rem;">
      <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 2rem;">
        <h2 style="font-size: 1.5rem;">Recent Audits</h2>
        <div style="display: flex; gap: 0.5rem;">
          <button onclick="exportData('json')" class="btn btn-outline"
            style="padding: 0.4rem 0.8rem; font-size: 0.8rem;">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
              style="margin-right: 4px;">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
              <polyline points="7 10 12 15 17 10"></polyline>
              <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
            JSON
          </button>
          <button onclick="exportData('csv')" class="btn btn-outline"
            style="padding: 0.4rem 0.8rem; font-size: 0.8rem;">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
              style="margin-right: 4px;">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
              <polyline points="7 10 12 15 17 10"></polyline>
              <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
            CSV
          </button>
          <button onclick="showHome()" class="btn btn-outline">&larr; New Analysis</button>
        </div>
      </div>

      <!-- Global Stats Summary -->
      <div class="global-stats-container">
        <div class="stat-card">
          <div class="stat-label">System Health</div>
          <div class="stat-value" id="stat-health">--<span class="stat-unit">%</span></div>
          <div class="stat-trend trend-up" id="stat-health-trend">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
              <polyline points="22 7 13.5 15.5 8.5 10.5 2 17"></polyline>
              <polyline points="16 7 22 7 22 13"></polyline>
            </svg>
            Optimal Uptime
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Avg. Response Time</div>
          <div class="stat-value" id="stat-latency">--<span class="stat-unit">s</span></div>
          <div class="stat-trend trend-neutral">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
              <circle cx="12" cy="12" r="10"></circle>
              <polyline points="12 6 12 12 16 14"></polyline>
            </svg>
            Live Latency
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Total Monitors</div>
          <div class="stat-value" id="stat-total">--</div>
          <div class="stat-trend trend-neutral">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
              <path
                d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z">
              </path>
            </svg>
            Active Traces
          </div>
        </div>
      </div>

      <div id="monitor-list" class="monitor-list">
        <!-- List Items -->
      </div>
    </section>

  </main>

  <!-- Footer -->
  <footer
    style="text-align: center; padding: 4rem 0; color: var(--text-muted); font-size: 0.9rem; border-top: 1px solid var(--border); margin-top: 4rem;">
    <div class="container">
      <p>&copy; 2026 UptimePro. All rights reserved.</p>
      <div style="margin-top: 1rem; display: flex; justify-content: center; gap: 2rem;">
        <span>Qais Amro</span>
        <span>Odai Edeh</span>
      </div>
    </div>
  </footer>

  <!-- App Logic -->

  <!-- Professional Chat Widget -->
  <div id="chat-widget" class="chat-widget" style="display: none;">
    <div class="chat-header">
      <div class="chat-header-info">
        <div class="chat-avatar">ðŸ¤–</div>
        <div class="chat-header-text">
          <div class="chat-title">Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©</div>
          <div class="chat-status">
            <span class="status-dot"></span>
            Ù…ØªØµÙ„ Ø§Ù„Ø¢Ù†
          </div>
        </div>
      </div>
      <div class="chat-header-actions">
        <button class="chat-action-btn" onclick="document.getElementById('chat-messages').innerHTML = '';"
          title="Ù…Ø³Ø­">ðŸ—‘ï¸</button>
        <button class="chat-action-btn" onclick="toggleChat()" title="Ø¥ØºÙ„Ø§Ù‚">âœ•</button>
      </div>
    </div>

    <div class="chat-messages" id="chat-messages">
      <div class="msg msg-bot">
        Ù…Ø±Ø­Ø¨Ø§Ù‹! ðŸ‘‹ Ø£Ù†Ø§ Ù…Ø³Ø§Ø¹Ø¯Ùƒ Ø§Ù„Ø°ÙƒÙŠ Ù„Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©. ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒØŸ
      </div>
    </div>

    <!-- Quick Questions - Above Input -->
    <div id="quick-questions">
      <button class="quick-btn" onclick="sendQuickMsg('Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù…')"><span>ðŸ“Š</span> Ø§Ù„Ø­Ø§Ù„Ø©</button>
      <button class="quick-btn" onclick="sendQuickMsg('Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ù…ØªÙˆÙ‚ÙØ©')"><span>âš ï¸</span> Ø§Ù„Ù…ØªÙˆÙ‚ÙØ©</button>
      <button class="quick-btn" onclick="sendQuickMsg('Ø£Ø¨Ø·Ø£ Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹')"><span>âš¡</span> Ø§Ù„Ø£Ø¨Ø·Ø£</button>
      <button class="quick-btn" onclick="sendQuickMsg('Ø¢Ø®Ø± ÙØ­Øµ')"><span>ðŸ”</span> Ø¢Ø®Ø± ÙØ­Øµ</button>
    </div>

    <form id="chat-form" class="chat-input-area">
      <input type="text" id="chat-input" placeholder="Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ Ù‡Ù†Ø§..." autocomplete="off">
      <button type="submit">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
          stroke-linecap="round" stroke-linejoin="round">
          <line x1="22" y1="2" x2="11" y2="13"></line>
          <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
        </svg>
      </button>
    </form>
  </div>


  <!-- Floating Chat Button -->
  <button onclick="toggleChat()"
    style="position: fixed; bottom: 20px; right: 20px; width: 54px; height: 54px; border-radius: 14px; background: linear-gradient(135deg, #2563eb, #1d4ed8); color: white; border: none; box-shadow: 0 6px 20px rgba(37, 99, 235, 0.35); cursor: pointer; z-index: 999; display: flex; align-items: center; justify-content: center; transition: all 0.25s ease;"
    onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 8px 28px rgba(37, 99, 235, 0.45)';"
    onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 6px 20px rgba(37, 99, 235, 0.35)';">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
    </svg>
  </button>



  <script>
    // Error Handler
    window.onerror = function (msg, url, line) {
      console.error("Critical JS Error:", msg, "at", url, ":", line);
      const app = document.body;
      if (app) app.insertAdjacentHTML('afterbegin', `<div style="position:fixed; top:0; left:0; width:100%; padding:1rem; background:red; color:white; z-index:9999; text-align:center;">âš ï¸ JavaScript Loading Error: ${msg} <button onclick="location.reload()" style="background:white; color:red; border:none; padding:0.2rem 0.5rem; margin-left:1rem; cursor:pointer;">Retry</button></div>`);
    };

    // ========== NEW FEATURES ==========

    // Toast Notifications
    window.showToast = function (message, type = 'info', duration = 3000) {
      const container = document.getElementById('toast-container');
      if (!container) return;

      const icons = { success: 'âœ“', error: 'âœ•', warning: 'âš ', info: 'â„¹' };
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      toast.innerHTML = `<span>${icons[type] || ''}</span> ${message}`;
      container.appendChild(toast);

      setTimeout(() => {
        toast.style.animation = 'toastFadeOut 0.3s ease-out forwards';
        setTimeout(() => toast.remove(), 300);
      }, duration);
    };

    // Theme Toggle
    window.toggleTheme = function () {
      const body = document.body;
      const isLight = body.classList.toggle('light-mode');
      localStorage.setItem('theme', isLight ? 'light' : 'dark');

      // Update icon
      const icon = document.getElementById('theme-icon');
      if (icon) {
        icon.innerHTML = isLight
          ? '<circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>'
          : '<path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>';
      }
      showToast(isLight ? 'Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„ÙØ§ØªØ­' : 'Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø¸Ù„Ù…', 'info', 1500);
    };

    // Load saved theme
    function loadTheme() {
      const saved = localStorage.getItem('theme');
      if (saved === 'light') {
        document.body.classList.add('light-mode');
        const icon = document.getElementById('theme-icon');
        if (icon) icon.innerHTML = '<circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>';
      }
    }

    // Health Indicator Update
    window.updateHealthIndicator = function (upCount, totalCount) {
      const indicator = document.getElementById('health-indicator');
      const text = document.getElementById('health-text');
      const fill = document.getElementById('health-fill');
      if (!indicator || !text || !fill) return;

      if (totalCount > 0) {
        indicator.style.display = 'flex';
        text.textContent = `${upCount}/${totalCount}`;
        const percent = (upCount / totalCount) * 100;
        fill.style.width = percent + '%';
        fill.className = 'health-fill ' + (percent >= 80 ? 'good' : percent >= 50 ? 'warning' : 'danger');
      }
    };

    // Keyboard Shortcuts
    document.addEventListener('keydown', function (e) {
      // Ctrl+K or Cmd+K - Focus search
      if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
        e.preventDefault();
        const input = document.getElementById('psi-url-input');
        if (input) { input.focus(); showToast('Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø³Ø±ÙŠØ¹', 'info', 1000); }
      }
      // Escape - Close modals/chat
      if (e.key === 'Escape') {
        const chat = document.getElementById('chat-widget');
        if (chat && chat.style.display === 'flex') {
          chat.style.display = 'none';
        }
      }
      // Ctrl+D - Toggle dark mode
      if ((e.ctrlKey || e.metaKey) && e.key === 'd') {
        e.preventDefault();
        toggleTheme();
      }
    });

    // Typing Indicator for Chat
    window.showTypingIndicator = function () {
      const msgArea = document.getElementById('chat-messages');
      if (!msgArea) return;
      const existing = document.getElementById('typing-msg');
      if (existing) return;

      msgArea.innerHTML += `<div id="typing-msg" class="msg msg-bot typing-indicator"><div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div></div>`;
      msgArea.scrollTop = msgArea.scrollHeight;
    };

    window.hideTypingIndicator = function () {
      const typing = document.getElementById('typing-msg');
      if (typing) typing.remove();
    };

    // ========== END NEW FEATURES ==========

    let token = localStorage.getItem('token');
    let selectedId = null;
    let chart = null;
    let currentStrategy = 'mobile';
    let auditTimers = {};
    // --- Chat Logic ---
    window.toggleChat = function () {
      const w = document.getElementById('chat-widget');
      if (!w) return;
      const isHidden = getComputedStyle(w).display === 'none';
      w.style.display = isHidden ? 'flex' : 'none';

      if (isHidden) {
        const input = document.getElementById('chat-input');
        if (input) setTimeout(() => input.focus(), 100);
      }
    }

    window.sendQuickMsg = function (text) {
      const input = document.getElementById('chat-input');
      if (input) {
        input.value = text;
        document.getElementById('chat-form').dispatchEvent(new Event('submit'));
      }
    }

    function setupChat() {
      const chatForm = document.getElementById('chat-form');
      if (!chatForm) return;

      chatForm.onsubmit = async (e) => {
        e.preventDefault();
        const input = document.getElementById('chat-input');
        const text = input.value.trim();
        if (!text) return;

        const msgArea = document.getElementById('chat-messages');
        // 1. Show User Message
        msgArea.innerHTML += `<div class="msg msg-user">${text}</div>`;
        input.value = '';
        msgArea.scrollTop = msgArea.scrollHeight;

        // 2. Show Typing Indicator
        const loadingId = 'loading-' + Date.now();
        msgArea.innerHTML += `<div id="${loadingId}" class="msg msg-bot typing-indicator"><div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div></div>`;
        msgArea.scrollTop = msgArea.scrollHeight;

        try {
          const res = await fetch('/api/v1/chat', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
            body: JSON.stringify({ message: text })
          });
          const data = await res.json();

          // 3. Show Reply
          const loader = document.getElementById(loadingId);
          if (loader) loader.outerHTML = `<div class="msg msg-bot">${data.reply}</div>`;
          msgArea.scrollTop = msgArea.scrollHeight;

        } catch (err) {
          const loader = document.getElementById(loadingId);
          if (loader) loader.innerText = "Error: Could not reach AI.";
        }
      };
    }


    // --- Auth ---
    function setupAuth() {
      const loginForm = document.getElementById('login-form');
      if (loginForm) {
        loginForm.onsubmit = async (e) => {
          e.preventDefault();
          const formData = new FormData();
          formData.append('username', e.target.username.value);
          formData.append('password', e.target.password.value);
          try {
            const res = await fetch('/api/v1/auth/login', { method: 'POST', body: formData });
            if (res.ok) {
              const data = await res.json();
              localStorage.setItem('token', data.access_token);
              localStorage.setItem('user', e.target.username.value);
              token = data.access_token;
              showToast('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­', 'success');
              init();
            } else {
              showToast('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰', 'error');
              document.getElementById('login-error').innerText = 'Invalid credentials';
            }
          } catch (err) {
            showToast('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…', 'error');
            document.getElementById('login-error').innerText = 'Connection Error';
          }
        };
      }
    }

    function logout() {
      console.log("Logging out...");
      localStorage.removeItem('token');
      token = null;
      document.getElementById('login-overlay').classList.remove('hidden');
      document.getElementById('hero-area').style.display = 'none';
      document.getElementById('dashboard-view').style.display = 'none';
      document.getElementById('report-view').style.display = 'none';
      showToast('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬', 'info');
    }

    async function api(path, opts = {}) {
      const currentToken = localStorage.getItem('token');
      if (currentToken) {
        opts.headers = { ...opts.headers, 'Authorization': `Bearer ${currentToken}` };
      }
      const res = await fetch(path, opts);
      if (res.status === 401) {
        console.warn("Session expired or unauthorized. Logging out.");
        logout();
        return;
      }
      if (!res.ok) {
        const err = await res.json().catch(() => ({ detail: "Unknown API error" }));
        throw new Error(err.detail || "Request failed");
      }
      return res.json();
    }

    // --- UI State ---
    window.setStrategy = function (mode) {
      currentStrategy = mode;
      const btnMobile = document.getElementById('btn-mobile');
      const btnDesktop = document.getElementById('btn-desktop');
      if (btnMobile) btnMobile.classList.toggle('active', mode === 'mobile');
      if (btnDesktop) btnDesktop.classList.toggle('active', mode === 'desktop');
    }

    window.showDashboard = function () {
      document.getElementById('hero-area').style.display = 'none';
      document.getElementById('report-view').style.display = 'none';
      const dashboardView = document.getElementById('dashboard-view');
      if (dashboardView) {
        dashboardView.style.display = 'block';
        dashboardView.classList.add('fade-in-up');
      }
      loadMonitors();
    }

    window.showAnalysis = function () {
      document.getElementById('hero-area').style.display = 'none';
      document.getElementById('dashboard-view').style.display = 'none';
      const reportView = document.getElementById('report-view');
      if (reportView) {
        reportView.style.display = 'block';
        reportView.classList.add('fade-in-up');
      }
    }

    window.showHome = function () {
      document.getElementById('dashboard-view').style.display = 'none';
      document.getElementById('report-view').style.display = 'none';
      const hero = document.getElementById('hero-area');
      if (hero) {
        hero.style.display = 'block';
        hero.classList.add('fade-in-up');
      }
    }

    function getScoreColor(score) {
      if (!score && score !== 0) return '#94a3b8';
      if (score >= 90) return '#10b981';
      if (score >= 50) return '#fbbf24';
      return '#ef4444';
    }

    // --- Core Audit Logic ---
    async function loadMonitors() {
      const list = document.getElementById('monitor-list');
      if (!list) return;

      // Show Skeletons
      list.innerHTML = `
        <div class="skeleton skeleton-card"></div>
        <div class="skeleton skeleton-card"></div>
        <div class="skeleton skeleton-card"></div>
      `;

      try {
        const monitors = await api('/api/v1/monitors');

        if (monitors.length === 0) {
          list.innerHTML = `<div class="empty-state">No audits found. <br><small>Start a new analysis from the home page.</small></div>`;
          updateHealthIndicator(0, 0);
          return;
        }

        // Calculate health & stats
        const upCount = monitors.filter(m => !m.checks || m.checks.length === 0 || m.checks[0].is_up).length;
        const uptimePct = Math.round((upCount / monitors.length) * 100);

        const scoredMonitors = monitors.filter(m => m.perf_fcp !== null);
        const avgLatency = scoredMonitors.length > 0
          ? (scoredMonitors.reduce((acc, m) => acc + m.perf_fcp, 0) / scoredMonitors.length).toFixed(2)
          : '--';

        // Update Summary Cards
        const healthEl = document.getElementById('stat-health');
        if (healthEl) healthEl.innerHTML = `${uptimePct}<span class="stat-unit">%</span>`;

        const latencyEl = document.getElementById('stat-latency');
        if (latencyEl) latencyEl.innerHTML = `${avgLatency}<span class="stat-unit">s</span>`;

        const totalEl = document.getElementById('stat-total');
        if (totalEl) totalEl.innerText = monitors.length;

        const healthTrend = document.getElementById('stat-health-trend');
        if (healthTrend) {
          if (uptimePct >= 90) {
            healthTrend.className = 'stat-trend trend-up';
            healthTrend.innerHTML = '<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"></polyline><polyline points="16 7 22 7 22 13"></polyline></svg> Optimal Uptime';
          } else {
            healthTrend.className = 'stat-trend trend-neutral';
            healthTrend.innerHTML = '<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg> Action Required';
          }
        }

        updateHealthIndicator(upCount, monitors.length);

        list.innerHTML = monitors.reverse().map(m => `
            <div class="monitor-item" id="monitor-${m.id}" onclick="showDetail(${m.id})">
                <div class="monitor-info">
                    <div class="monitor-name">
                        ${m.name}
                        <span class="badge badge-strategy">${m.strategy || 'mobile'}</span>
                    </div>
                    <div class="monitor-url">${m.url}</div>
                </div>
                <div class="monitor-stats">
                    <div class="score-pill" style="color: ${getScoreColor(m.perf_score)}; border-color: ${getScoreColor(m.perf_score)}20; background: ${getScoreColor(m.perf_score)}10;">
                        <span class="score-label">Score</span>
                        <span class="score-val">${m.perf_score !== null ? Math.round(m.perf_score) : '--'}</span>
                    </div>
                    <button class="btn-icon btn-delete" onclick="event.stopPropagation(); deleteMonitor(${m.id})" title="Delete Trace">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
                    </button>
                </div>
            </div>
          `).join('');
      } catch (err) {
        console.error("Failed to load monitors", err);
        list.innerHTML = `<div style="color:red; padding:1rem;">âš ï¸ Error loading monitors. Please try again.</div>`;
      }
    }

    window.deleteMonitor = async function (id) {
      if (!confirm('Delete this analysis trace?')) return;
      const item = document.getElementById(`monitor-${id}`);
      if (item) item.classList.add('deleting');
      setTimeout(async () => {
        try {
          await api(`/api/v1/monitors/${id}`, { method: 'DELETE' });
          showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„ØªØ¯Ù‚ÙŠÙ‚ Ø¨Ù†Ø¬Ø§Ø­', 'success');
          loadMonitors();
        } catch (err) {
          showToast('ÙØ´Ù„ ÙÙŠ Ø­Ø°Ù Ø§Ù„ØªØ¯Ù‚ÙŠÙ‚', 'error');
          if (item) item.classList.remove('deleting');
        }
      }, 300);
    }

    function startCountdown(id) {
      if (auditTimers[id]) return;
      let val = 60;
      const statusMsgs = [
        { time: 55, en: "Connecting to Engine...", ar: "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„..." },
        { time: 40, en: "Running Lighthouse...", ar: "Ø¬Ø§Ø±ÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„ÙØ­Øµ..." },
        { time: 25, en: "Processing Assets...", ar: "Ø¬Ø§Ø±ÙŠ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª..." },
        { time: 10, en: "Finalizing Report...", ar: "Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ±..." }
      ];

      auditTimers[id] = setInterval(() => {
        val--;
        if (selectedId === id) {
          const area = document.getElementById('audit-countdown');
          if (area) area.style.display = 'block';
          const pb = document.getElementById('audit-progress-bar');
          if (pb) pb.style.width = `${((60 - val) / 60) * 100}%`;
          const ts = document.getElementById('timer-val');
          if (ts) ts.innerText = val > 0 ? val : "Wait...";
          const msg = statusMsgs.find(m => val >= m.time) || statusMsgs[statusMsgs.length - 1];
          const st = document.getElementById('audit-status-msg');
          if (st) st.innerText = `ðŸš€ ${msg.en} | ${msg.ar}`;
        }
        if (val <= -120) { clearInterval(auditTimers[id]); delete auditTimers[id]; }
      }, 1000);
    }

    // --- Search Suggestions & Recent URLs ---
    let recentUrls = JSON.parse(localStorage.getItem('recentUrls') || '[]');

    function saveRecentUrls() {
      localStorage.setItem('recentUrls', JSON.stringify(recentUrls));
    }

    window.addRecentUrl = function (url) {
      if (!url) return;
      // remove if already exists to move to top
      recentUrls = recentUrls.filter(u => u !== url);
      recentUrls.unshift(url);
      if (recentUrls.length > 5) recentUrls.pop();
      saveRecentUrls();
      renderSuggestions();
    }

    window.clearRecentUrls = function (e) {
      if (e) e.stopPropagation();
      recentUrls = [];
      saveRecentUrls();
      renderSuggestions();
      showToast('Search history cleared', 'info');
    }

    window.selectSuggestion = function (url) {
      const input = document.getElementById('psi-url-input');
      if (input) {
        input.value = url;
        const suggestionsBox = document.getElementById('search-suggestions');
        if (suggestionsBox) suggestionsBox.style.display = 'none';
        // Trigger focus for a nice effect
        setTimeout(() => input.focus(), 100);
      }
    }

    function renderSuggestions(filter = '') {
      const box = document.getElementById('search-suggestions');
      if (!box) return;

      const filtered = recentUrls.filter(u => u.toLowerCase().includes(filter.toLowerCase()));

      if (filtered.length === 0 && !filter) {
        box.style.display = 'none';
        return;
      }

      let html = `
        <div class="suggestion-header">
          <span>${filter ? 'Suggestions' : 'Recent Searches'}</span>
          ${recentUrls.length > 0 ? `<span class="clear-history" onclick="clearRecentUrls(event)">Clear History</span>` : ''}
        </div>
      `;

      if (filtered.length === 0) {
        html += `<div class="suggestion-item" style="cursor: default; opacity: 0.6;">No matches found</div>`;
      } else {
        html += filtered.map(url => `
          <div class="suggestion-item" onclick="selectSuggestion('${url}')">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="opacity: 0.5;">
              <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line>
            </svg>
            ${url}
          </div>
        `).join('');
      }

      box.innerHTML = html;
      box.style.display = 'block';
    }

    function setupSuggestions() {
      const input = document.getElementById('psi-url-input');
      const box = document.getElementById('search-suggestions');
      if (!input || !box) return;

      input.onfocus = () => renderSuggestions(input.value);
      input.oninput = () => renderSuggestions(input.value);

      // Close box when clicking outside
      document.addEventListener('click', (e) => {
        if (!input.contains(e.target) && !box.contains(e.target)) {
          box.style.display = 'none';
        }
      });
    }

    // --- Data Export ---
    window.exportData = async function (format) {
      showToast(`Preparing ${format.toUpperCase()} export...`, 'info');
      try {
        const monitors = await api('/api/v1/monitors');
        if (!monitors || monitors.length === 0) {
          showToast('No data to export', 'warning');
          return;
        }

        let blob;
        let filename = `web_health_export_${new Date().toISOString().split('T')[0]}`;

        if (format === 'json') {
          const dataStr = JSON.stringify(monitors, null, 2);
          blob = new Blob([dataStr], { type: 'application/json' });
          filename += '.json';
        } else if (format === 'csv') {
          const headers = ['ID', 'Name', 'URL', 'Strategy', 'Interval', 'Performance Score', 'Last FCP'];
          const rows = monitors.map(m => [
            m.id,
            `"${m.name}"`,
            `"${m.url}"`,
            m.strategy || 'mobile',
            m.interval_seconds,
            m.perf_score ?? '--',
            m.perf_fcp ?? '--'
          ]);
          const csvContent = [headers.join(','), ...rows.map(r => r.join(','))].join('\n');
          blob = new Blob([csvContent], { type: 'text/csv' });
          filename += '.csv';
        }

        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.style.display = 'none';
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        window.URL.revokeObjectURL(url);
        showToast('Export successful!', 'success');
      } catch (err) {
        console.error("Export failed:", err);
        showToast('Failed to export data', 'error');
      }
    }

    function setupPSIForm() {
      const form = document.getElementById('psi-search-form');
      if (!form) return;

      form.onsubmit = async (e) => {
        e.preventDefault();
        let url = document.getElementById('psi-url-input').value;
        if (!url) return;
        if (!url.startsWith('http')) url = 'https://' + url;
        const btn = form.querySelector('button[type="submit"]');
        const originalText = btn.innerHTML;
        btn.innerHTML = "<span class='spinner'></span> Analyzing..."; btn.disabled = true;

        showToast('Ø¨Ø¯Ø¡ ÙØ­Øµ Ø§Ù„Ù…ÙˆÙ‚Ø¹...', 'info');

        try {
          const hostname = new URL(url).hostname;
          const res = await api('/api/v1/monitors', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ name: hostname, url: url, interval_seconds: 60, strategy: currentStrategy })
          });
          if (res && res.id) {
            addRecentUrl(url); // Save to history
            showToast('ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆÙ‚Ø¹ØŒ Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù†ØªØ§Ø¦Ø¬...', 'success');
            selectedId = res.id;
            startCountdown(res.id);
            showDetail(res.id);
            showAnalysis();
          }
        } catch (err) {
          showToast('ÙØ´Ù„ ÙÙŠ Ø¨Ø¯Ø¡ Ø§Ù„ÙØ­Øµ: ' + err.message, 'error');
          alert("Error starting analysis: " + err.message);
        }
        finally { btn.innerHTML = originalText; btn.disabled = false; }
      };
    }

    window.showDetail = async function (id, retryCount = 0) {
      try {
        selectedId = id;
        showAnalysis();
        const ds = document.getElementById('detail-section');
        if (ds && retryCount === 0) ds.innerHTML = '<div class="loading-state"><div class="spinner-large"></div><h2>Generated Analysis Report...</h2></div>';

        // Set date for print footer
        if (ds) ds.setAttribute('data-date', new Date().toLocaleDateString() + ' ' + new Date().toLocaleTimeString());

        const monitors = await api('/api/v1/monitors');
        const m = monitors.find(x => x.id === id);
        if (!m) {
          console.error("Monitor not found for ID:", id);
          return;
        }

        // Auto-start countdown if audit is pending
        if (m.perf_score === null && !auditTimers[id]) {
          console.log("â±ï¸ Audit pending, starting countdown...");
          startCountdown(id);
        }

        if (!ds) return;

        ds.innerHTML = `
        <div class="report-header glass-panel fade-in-up">
            <div class="header-content">
                <button onclick="showHome()" class="btn-back">&larr; Back</button>
                <div class="header-title-group">
                    <h1>${m.url}</h1>
                    <div class="strategy-badge ${m.strategy || 'mobile'}">
                        ${m.strategy === 'desktop' ? '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect><line x1="8" y1="21" x2="16" y2="21"></line><line x1="12" y1="17" x2="12" y2="21"></line></svg>' : '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="5" y="2" width="14" height="20" rx="2" ry="2"></rect><line x1="12" y1="18" x2="12.01" y2="18"></line></svg>'}
                        ${m.strategy || 'mobile'}
                    </div>
                </div>
            </div>
            
            <div id="audit-countdown" class="audit-status-panel" style="display: ${(auditTimers[id] || m.perf_score === null) ? 'flex' : 'none'};">
                <div class="status-text-pulse" id="audit-status-msg">${m.perf_score === null && !auditTimers[id] ? 'âŒ› Analysis Pending...' : 'ðŸš€ Analyzing...'}</div>
                <div class="progress-wrapper">
                    <div class="progress-fill" id="audit-progress-bar" style="width: ${m.perf_score === null ? '30%' : '0%'}; transition: width 1s;"></div>
                </div>
                <div class="time-est">Est. Time: <span id="timer-val">60</span>s</div>
            </div>
            
            <div class="header-actions">
                <button onclick="window.print()" class="btn btn-outline">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9V2h12v7"></path><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path><rect x="6" y="14" width="12" height="8"></rect></svg>
                    Export PDF
                </button>
                <button onclick="triggerManualAudit()" id="refresh-btn" class="btn btn-primary" style="display: ${auditTimers[id] ? 'none' : 'flex'};">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 4 23 10 17 10"></polyline><polyline points="1 20 1 14 7 14"></polyline><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path></svg>
                    Re-Analyze
                </button>
            </div>
        </div>

        <div class="report-grid">
            <div class="metrics-overview glass-panel fade-in-up" style="animation-delay: 0.1s;">
                <div class="gauges-container">
                    ${renderGauge('Performance', m.perf_score, 'Ø§Ù„Ø£Ø¯Ø§Ø¡')}
                    ${renderGauge('Accessibility', m.perf_accessible, 'Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø§Ù„ÙˆØµÙˆÙ„')}
                    ${renderGauge('Best Practices', m.perf_best_practices, 'Ø£ÙØ¶Ù„ Ø§Ù„Ù…Ù…Ø§Ø±Ø³Ø§Øª')}
                    ${renderGauge('SEO', m.perf_seo, 'Ù…Ø­Ø±ÙƒØ§Øª Ø§Ù„Ø¨Ø­Ø«')}
                </div>
            </div>
            <div class="screenshot-panel glass-panel fade-in-up" style="animation-delay: 0.2s;">
                <div id="screenshot-container" class="screenshot-frame">
                    ${m.perf_screenshot ? `<img src="${m.perf_screenshot}" alt="Page Screenshot">` : `<div class="placeholder-screenshot"><div class="spinner"></div><p>Generating Preview...</p></div>`}
                </div>
            </div>
        </div>

        <div class="glass-panel filmstrip-panel fade-in-up" style="animation-delay: 0.3s; margin-top: 2rem;">
            <h2>Loading Timeline (Ø§Ù„ØªØ³Ù„Ø³Ù„ Ø§Ù„Ø²Ù…Ù†ÙŠ)</h2>
            <div class="filmstrip-row">
                ${(m.perf_thumbnails || []).map(t => `<div class="filmstrip-item"><img src="${t.data}"><div class="filmstrip-time">${Math.round(t.timing)}ms</div></div>`).join('') || '<p class="empty-msg">Visual timeline will appear after audit completes.</p>'}
            </div>
        </div>

        <div class="key-metrics-grid fade-in-up" style="animation-delay: 0.4s;">
            ${renderMetric('First Contentful Paint', `${m.perf_fcp || '...'}s`, "FCP")}
            ${renderMetric('Largest Contentful Paint', `${m.perf_lcp || '...'}s`, "LCP")}
            ${renderMetric('Cumulative Layout Shift', m.perf_cls || '...', "CLS")}
            ${renderMetric('Total Blocking Time', `${m.perf_tbt || '...'}ms`, "TBT")}
        </div>

        <div id="error-section" class="opportunities-section fade-in-up" style="display: ${m.perf_details && m.perf_details.length > 0 ? 'block' : 'none'}; animation-delay: 0.5s;">
            <h2 style="margin-bottom: 2rem;">Opportunities (ÙØ±Øµ Ø§Ù„ØªØ­Ø³ÙŠÙ†)</h2>
            <div class="opportunities-list">
                ${(m.perf_details || []).map(e => `
                    <div class="opportunity-card" style="border-left-color: ${getScoreColor(e.score * 100)};">
                        <div class="opp-header">
                            <div class="opp-title">${e.title}</div>
                            <div class="opp-score" style="color: ${getScoreColor(e.score * 100)}">Impact: ${Math.round((1 - e.score) * 100)}</div>
                        </div>
                        <div class="opp-desc">${e.description}</div>
                    </div>
                `).join('')}
            </div>
        </div>

        <div class="glass-panel chart-panel fade-in-up" style="animation-delay: 0.6s;">
            <h2>Response Time History</h2>
            <div class="chart-container"><canvas id="responseChart"></canvas></div>
        </div>
        `;
        renderChart(id);
      } catch (err) {
        console.error("Dashboard error:", err);
        const ds = document.getElementById('detail-section');
        if (ds) ds.innerHTML = `<div class="error-state"><h2>âš ï¸ Error loading report</h2><p>${err.message}</p><button class="btn btn-primary" onclick="showDashboard()">Back to Dashboard</button></div>`;
      }
    }

    function renderGauge(label, score, ar) {
      const color = getScoreColor(score);
      return `
        <div class="gauge-wrapper">
            <div class="gauge-chart">
                <svg viewBox="0 0 36 36" class="circular-chart">
                    <path d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" class="circle-bg" />
                    <path d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" class="circle" stroke="${color}" stroke-dasharray="${score || 0}, 100" />
                </svg>
                <div class="gauge-value" style="color: ${color}">${score !== null ? Math.round(score) : '--'}</div>
            </div>
            <div class="gauge-label">
                <span class="en">${label}</span>
                <span class="ar">${ar}</span>
            </div>
        </div>`;
    }

    function renderMetric(title, val, acronym) {
      return `
      <div class="metric-card glass-panel">
          <div class="metric-header">
              <span class="metric-acronym">${acronym}</span>
              <span class="metric-title">${title}</span>
          </div>
          <div class="metric-value">${val}</div>
      </div>`;
    }

    window.triggerManualAudit = async function () {
      if (!selectedId) return;
      showToast('Ø¬Ø§Ø±ÙŠ Ø¥Ø¹Ø§Ø¯Ø© ÙØ­Øµ Ø§Ù„Ù…ÙˆÙ‚Ø¹...', 'info');
      try {
        await api(`/api/v1/monitors/${selectedId}/audit?strategy=${currentStrategy}`, { method: 'POST' });
        showToast('ØªÙ… Ø¨Ø¯Ø¡ Ø§Ù„ÙØ­Øµ Ø§Ù„ÙÙˆØ±ÙŠ Ø¨Ù†Ø¬Ø§Ø­', 'success');
        startCountdown(selectedId);
        showDetail(selectedId);
      } catch (err) {
        showToast('ÙØ´Ù„ ÙÙŠ Ø·Ù„Ø¨ Ø§Ù„ÙØ­Øµ Ø§Ù„ÙÙˆØ±ÙŠ', 'error');
      }
    }

    async function renderChart(id) {
      if (typeof Chart === 'undefined') {
        return;
      }
      const checks = await api(`/monitors/${id}/checks?limit=20`);
      if (chart) chart.destroy();
      if (!checks || !checks.length) return;
      const ctx = document.getElementById('responseChart').getContext('2d');

      // Custom Chart Gradient
      const gradient = ctx.createLinearGradient(0, 0, 0, 400);
      gradient.addColorStop(0, 'rgba(139, 92, 246, 0.5)'); // primary
      gradient.addColorStop(1, 'rgba(139, 92, 246, 0.0)');

      chart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: checks.reverse().map(d => new Date(d.checked_at).toLocaleTimeString()),
          datasets: [{
            data: checks.map(d => d.response_ms),
            borderColor: '#8b5cf6',
            backgroundColor: gradient,
            fill: true,
            tension: 0.4,
            pointBackgroundColor: '#8b5cf6',
            pointBorderColor: '#fff',
            pointHoverBackgroundColor: '#fff',
            pointHoverBorderColor: '#8b5cf6'
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { display: false },
            tooltip: {
              mode: 'index',
              intersect: false,
              backgroundColor: 'rgba(15, 23, 42, 0.9)',
              titleColor: '#f1f5f9',
              bodyColor: '#cbd5e1',
              borderColor: 'rgba(255,255,255,0.1)',
              borderWidth: 1
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              grid: { color: 'rgba(255,255,255,0.05)' },
              ticks: { color: '#94a3b8' }
            },
            x: {
              grid: { display: false },
              ticks: { display: false }
            }
          },
          interaction: {
            mode: 'nearest',
            axis: 'x',
            intersect: false
          }
        }
      });
    }

    function setupWS() {
      const protocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
      const ws = new WebSocket(`${protocol}//${location.host}/ws`);
      ws.onmessage = (event) => {
        const data = JSON.parse(event.data);
        if (data.event === 'monitor_created') startCountdown(data.monitor_id);
        if (data.event === 'audit_finished') {
          if (auditTimers[data.monitor_id]) { clearInterval(auditTimers[data.monitor_id]); delete auditTimers[data.monitor_id]; }
          if (selectedId === data.monitor_id) {
            const sm = document.getElementById('audit-status-msg');
            if (sm) { sm.innerText = "âœ… Analysis Received! Syncing..."; sm.style.color = "var(--success)"; }
            const pb = document.getElementById('audit-progress-bar');
            if (pb) pb.style.width = '100%';
            if (pb) pb.style.width = '100%';
            // Immediate update as requested
            setTimeout(() => showDetail(data.monitor_id), 100);
          }
          loadMonitors();
        }
        if (data.event === 'audit_failed') {
          if (auditTimers[data.monitor_id]) { clearInterval(auditTimers[data.monitor_id]); delete auditTimers[data.monitor_id]; }
          if (selectedId === data.monitor_id) {
            const sm = document.getElementById('audit-status-msg');
            if (sm) { sm.innerText = `âŒ Audit Failed: ${data.error || 'Blocked or Timeout'}`; sm.style.color = "var(--danger)"; }
            const pb = document.getElementById('audit-progress-bar');
            if (pb) pb.style.background = 'var(--danger)';
          }
        }
        if (data.event === 'check_finished') {
          loadMonitors();
          if (selectedId === data.monitor_id) renderChart(selectedId);
        }
      };
    }

    function init() {
      console.log("ðŸš€ Initializing App...");

      // Load saved theme
      loadTheme();

      // Setup global event listeners
      setupAuth();
      setupSuggestions();
      setupPSIForm();
      setupChat();

      if (token) {
        console.log("ðŸ”‘ Session found. Hiding overlay.");
        const overlay = document.getElementById('login-overlay');
        if (overlay) overlay.classList.add('hidden');

        try {
          const userDisplay = document.getElementById('user-display');
          if (userDisplay) userDisplay.innerText = `Signed in as ${localStorage.getItem('user') || 'Admin'}`;

          setupWS();
          const hero = document.getElementById('hero-area');
          if (hero) hero.style.display = 'block';
          console.log("âœ… App Ready.");
        } catch (err) {
          console.error("Initialization failed:", err);
        }
      } else {
        console.log("ðŸŽŸï¸ No session. Showing login.");
      }
    }

    // Start
    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>

</html>